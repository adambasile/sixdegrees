/*! selectize.js - v0.13.3 | https://github.com/selectize/selectize.js | Apache License (v2) */

!function(t,e){"function"==typeof define&&define.amd?define("sifter",e):"object"==typeof exports?module.exports=e():t.Sifter=e()}(this,function(){function t(t,e){this.items=t,this.settings=e||{diacritics:!0}}t.prototype.tokenize=function(t){if(!(t=s(String(t||"").toLowerCase()))||!t.length)return[];for(var e,i,n=[],r=t.split(/ +/),l=0,h=r.length;l<h;l++){if(e=o(r[l]),this.settings.diacritics)for(i in a)a.hasOwnProperty(i)&&(e=e.replace(new RegExp(i,"g"),a[i]));n.push({string:r[l],regex:new RegExp(e,"i")})}return n},t.prototype.iterator=function(t,e){(r(t)?Array.prototype.forEach||function(t){for(var e=0,i=this.length;e<i;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)}).apply(t,[e])},t.prototype.getScoreFunction=function(t,e){var i,s,o,r;function a(t,e){var i;return t&&-1!==(i=(t=String(t||"")).search(e.regex))?(t=e.string.length/t.length,0===i&&(t+=.5),t):0}t=this.prepareSearch(t,e),s=t.tokens,i=t.options.fields,o=s.length,r=t.options.nesting;var l,h=(l=i.length)?1===l?function(t,e){return a(n(e,i[0],r),t)}:function(t,e){for(var s=0,o=0;s<l;s++)o+=a(n(e,i[s],r),t);return o/l}:function(){return 0};return o?1===o?function(t){return h(s[0],t)}:"and"===t.options.conjunction?function(t){for(var e,i=0,n=0;i<o;i++){if((e=h(s[i],t))<=0)return 0;n+=e}return n/o}:function(t){for(var e=0,i=0;e<o;e++)i+=h(s[e],t);return i/o}:function(){return 0}},t.prototype.getSortFunction=function(t,i){var s,o,r,a,l,h,u,p=this,c=!(t=p.prepareSearch(t,i)).query&&i.sort_empty||i.sort,d=function(t,e){return"$score"===t?e.score:n(p.items[e.id],t,i.nesting)},g=[];if(c)for(s=0,o=c.length;s<o;s++)!t.query&&"$score"===c[s].field||g.push(c[s]);if(t.query){for(u=!0,s=0,o=g.length;s<o;s++)if("$score"===g[s].field){u=!1;break}u&&g.unshift({field:"$score",direction:"desc"})}else for(s=0,o=g.length;s<o;s++)if("$score"===g[s].field){g.splice(s,1);break}for(h=[],s=0,o=g.length;s<o;s++)h.push("desc"===g[s].direction?-1:1);return(a=g.length)?1===a?(r=g[0].field,l=h[0],function(t,i){return l*e(d(r,t),d(r,i))}):function(t,i){for(var n,s=0;s<a;s++)if(n=g[s].field,n=h[s]*e(d(n,t),d(n,i)))return n;return 0}:null},t.prototype.prepareSearch=function(t,e){if("object"==typeof t)return t;var n=(e=i({},e)).fields,s=e.sort,o=e.sort_empty;return n&&!r(n)&&(e.fields=[n]),s&&!r(s)&&(e.sort=[s]),o&&!r(o)&&(e.sort_empty=[o]),{options:e,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,e){var i,n,s=this.prepareSearch(t,e);return e=s.options,t=s.query,n=e.score||this.getScoreFunction(s),t.length?this.iterator(this.items,function(t,o){i=n(t),(!1===e.filter||0<i)&&s.items.push({score:i,id:o})}):this.iterator(this.items,function(t,e){s.items.push({score:1,id:e})}),(t=this.getSortFunction(s,e))&&s.items.sort(t),s.total=s.items.length,"number"==typeof e.limit&&(s.items=s.items.slice(0,e.limit)),s};var e=function(t,e){return"number"==typeof t&&"number"==typeof e?e<t?1:t<e?-1:0:(t=l(String(t||"")),(e=l(String(e||"")))<t?1:t<e?-1:0)},i=function(t,e){for(var i,n,s=1,o=arguments.length;s<o;s++)if(n=arguments[s])for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return t},n=function(t,e,i){if(t&&e){if(!i)return t[e];for(var n=e.split(".");n.length&&(t=t[n.shift()]););return t}},s=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},o=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},r=Array.isArray||"undefined"!=typeof $&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},a={a:"[aá¸€á¸Ä‚ÄƒÃ‚Ã¢ÇÇŽÈºâ±¥È¦È§áº áº¡Ã„Ã¤Ã€Ã ÃÃ¡Ä€ÄÃƒÃ£Ã…Ã¥Ä…Ä„ÃƒÄ…Ä„]",b:"[bâ¢Î²Î’Bà¸¿ðŒá›’]",c:"[cÄ†Ä‡ÄˆÄ‰ÄŒÄÄŠÄ‹CÌ„cÌ„Ã‡Ã§á¸ˆá¸‰È»È¼Æ‡ÆˆÉ•á´„ï¼£ï½ƒ]",d:"[dÄŽÄá¸Šá¸‹á¸á¸‘á¸Œá¸á¸’á¸“á¸Žá¸ÄÄ‘DÌ¦dÌ¦Æ‰É–ÆŠÉ—Æ‹ÆŒáµ­á¶á¶‘È¡á´…ï¼¤ï½„Ã°]",e:"[eÃ‰Ã©ÃˆÃ¨ÃŠÃªá¸˜á¸™ÄšÄ›Ä”Ä•áº¼áº½á¸šá¸›áººáº»Ä–Ä—Ã‹Ã«Ä’Ä“È¨È©Ä˜Ä™á¶’É†É‡È„È…áº¾áº¿á»€á»á»„á»…á»‚á»ƒá¸œá¸á¸–á¸—á¸”á¸•È†È‡áº¸áº¹á»†á»‡â±¸á´‡ï¼¥ï½…É˜ÇÆÆÎµ]",f:"[fÆ‘Æ’á¸žá¸Ÿ]",g:"[gÉ¢â‚²Ç¤Ç¥ÄœÄÄžÄŸÄ¢Ä£Æ“É Ä Ä¡]",h:"[hÄ¤Ä¥Ä¦Ä§á¸¨á¸©áº–áº–á¸¤á¸¥á¸¢á¸£É¦Ê°Ç¶Æ•]",i:"[iÃÃ­ÃŒÃ¬Ä¬Ä­ÃŽÃ®ÇÇÃÃ¯á¸®á¸¯Ä¨Ä©Ä®Ä¯ÄªÄ«á»ˆá»‰ÈˆÈ‰ÈŠÈ‹á»Šá»‹á¸¬á¸­Æ—É¨É¨Ì†áµ»á¶–Ä°iIÄ±Éªï¼©ï½‰]",j:"[jÈ·Ä´ÄµÉˆÉ‰ÊÉŸÊ²]",k:"[kÆ˜Æ™ê€êá¸°á¸±Ç¨Ç©á¸²á¸³á¸´á¸µÎºÏ°â‚­]",l:"[lÅÅ‚Ä½Ä¾Ä»Ä¼Ä¹Äºá¸¶á¸·á¸¸á¸¹á¸¼á¸½á¸ºá¸»Ä¿Å€È½Æšâ± â±¡â±¢É«É¬á¶…É­È´ÊŸï¼¬ï½Œ]",n:"[nÅƒÅ„Ç¸Ç¹Å‡ÅˆÃ‘Ã±á¹„á¹…Å…Å†á¹†á¹‡á¹Šá¹‹á¹ˆá¹‰NÌˆnÌˆÆÉ²È Æžáµ°á¶‡É³ÈµÉ´ï¼®ï½ŽÅŠÅ‹]",o:"[oÃ˜Ã¸Ã–Ã¶Ã“Ã³Ã’Ã²Ã”Ã´Ç‘Ç’ÅÅ‘ÅŽÅÈ®È¯á»Œá»ÆŸÉµÆ Æ¡á»Žá»ÅŒÅÃ•ÃµÇªÇ«ÈŒÈÕ•Ö…]",p:"[pá¹”á¹•á¹–á¹—â±£áµ½Æ¤Æ¥áµ±]",q:"[qê–ê—Ê ÉŠÉ‹ê˜ê™qÌƒ]",r:"[rÅ”Å•ÉŒÉÅ˜Å™Å–Å—á¹˜á¹™ÈÈ‘È’È“á¹šá¹›â±¤É½]",s:"[sÅšÅ›á¹ á¹¡á¹¢á¹£êž¨êž©ÅœÅÅ Å¡ÅžÅŸÈ˜È™SÌˆsÌˆ]",t:"[tÅ¤Å¥á¹ªá¹«Å¢Å£á¹¬á¹­Æ®ÊˆÈšÈ›á¹°á¹±á¹®á¹¯Æ¬Æ­]",u:"[uÅ¬Å­É„Ê‰á»¤á»¥ÃœÃ¼ÃšÃºÃ™Ã¹Ã›Ã»Ç“Ç”Å°Å±Å¬Å­Æ¯Æ°á»¦á»§ÅªÅ«Å¨Å©Å²Å³È”È•âˆª]",v:"[vá¹¼á¹½á¹¾á¹¿Æ²Ê‹êžêŸâ±±Ê‹]",w:"[wáº‚áºƒáº€áºÅ´Åµáº„áº…áº†áº‡áºˆáº‰]",x:"[xáºŒáºáºŠáº‹Ï‡]",y:"[yÃÃ½á»²á»³Å¶Å·Å¸Ã¿á»¸á»¹áºŽáºá»´á»µÉŽÉÆ³Æ´]",z:"[zÅ¹Åºáºáº‘Å½Å¾Å»Å¼áº’áº“áº”áº•ÆµÆ¶]"},l=function(){var t,e,i,n,s="",o={};for(i in a)if(a.hasOwnProperty(i))for(s+=n=a[i].substring(2,a[i].length-1),t=0,e=n.length;t<e;t++)o[n.charAt(t)]=i;var r=new RegExp("["+s+"]","g");return function(t){return t.replace(r,function(t){return o[t]}).toLowerCase()}}();return t}),function(t,e){"function"==typeof define&&define.amd?define("microplugin",e):"object"==typeof exports?module.exports=e():t.MicroPlugin=e()}(this,function(){var t={mixin:function(t){t.plugins={},t.prototype.initializePlugins=function(t){var i,n,s,o=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},e.isArray(t))for(i=0,n=t.length;i<n;i++)"string"==typeof t[i]?o.push(t[i]):(this.plugins.settings[t[i].name]=t[i].options,o.push(t[i].name));else if(t)for(s in t)t.hasOwnProperty(s)&&(this.plugins.settings[s]=t[s],o.push(s));for(;o.length;)this.require(o.shift())},t.prototype.loadPlugin=function(e){var i=this.plugins,n=t.plugins[e];if(!t.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');i.requested[e]=!0,i.loaded[e]=n.fn.apply(this,[this.plugins.settings[e]||{}]),i.names.push(e)},t.prototype.require=function(t){var e=this.plugins;if(!this.plugins.loaded.hasOwnProperty(t)){if(e.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');this.loadPlugin(t)}return e.loaded[t]},t.define=function(e,i){t.plugins[e]={name:e,fn:i}}}},e={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,e){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("jquery"),require("sifter"),require("microplugin")):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function(t,e,i){"use strict";function n(){}function s(t){return void 0!==t}function o(t){return null==t?null:"boolean"==typeof t?t?"1":"0":t+""}function r(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function a(t,e,i){var n,s=t.trigger,o={};for(n in t.trigger=function(){var i=arguments[0];if(-1===e.indexOf(i))return s.apply(t,arguments);o[i]=arguments},i.apply(t,[]),t.trigger=s,o)o.hasOwnProperty(n)&&s.apply(t,o[n])}function l(t){var e,i,n={};return void 0===t?console.warn("WARN getSelection cannot locate input control"):"selectionStart"in t?(n.start=t.selectionStart,n.length=t.selectionEnd-n.start):document.selection&&(t.focus(),e=document.selection.createRange(),i=document.selection.createRange().text.length,e.moveStart("character",-t.value.length),n.start=e.text.length-i,n.length=i),n}function h(e){function i(i,s){var o,r,a,h,u,p;s=s||{},(i=i||window.event||{}).metaKey||i.altKey||!s.force&&!1===e.data("grow")||(r=e.val(),i.type&&"keydown"===i.type.toLowerCase()&&(a=48<=(o=i.keyCode)&&o<=57||65<=o&&o<=90||96<=o&&o<=111||186<=o&&o<=222||32===o,46===o||8===o?(s=l(e[0])).length?r=r.substring(0,s.start)+r.substring(s.start+s.length):8===o&&s.start?r=r.substring(0,s.start-1)+r.substring(s.start+1):46===o&&void 0!==s.start&&(r=r.substring(0,s.start)+r.substring(s.start+1)):a&&(a=i.shiftKey,h=String.fromCharCode(i.keyCode),r+=h=a?h.toUpperCase():h.toLowerCase())),h=e.attr("placeholder"),u=r=!r&&h?h:r,p=e,(r=(u?(m.$testInput||(m.$testInput=t("<span />").css({position:"absolute",width:"auto",padding:0,whiteSpace:"pre"}),t("<div />").css({position:"absolute",width:0,height:0,overflow:"hidden"}).append(m.$testInput).appendTo("body")),m.$testInput.text(u),function(t,e,i){var n,s,o={};if(i)for(n=0,s=i.length;n<s;n++)o[i[n]]=t.css(i[n]);else o=t.css();e.css(o)}(p,m.$testInput,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]),m.$testInput.width()):0)+4)!==n&&(n=r,e.width(r),e.triggerHandler("resize")))}var n=null;e.on("keydown keyup update blur",i),i()}t.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName;var t=this.parentNode;t.replaceChild(this.firstChild,this),t.normalize()}).end()},n.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var i=arguments.length;return 0===i?delete this._events:1===i?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=0)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},n.mixin=function(t){for(var e=["on","off","trigger"],i=0;i<e.length;i++)t.prototype[e[i]]=n.prototype[e[i]]};var u,p,c=/Mac/.test(navigator.userAgent),d=c?91:17,g=c?18:17,f=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("input").validity,v=function(t,e,i){var n=t[e];t[e]=function(){var e=n.apply(t,arguments);return i.apply(t,arguments),e}},m=function(i,n){var s,o,r=i[0];r.selectize=this;var a,l,h,u=window.getComputedStyle&&window.getComputedStyle(r,null);if(u=(u=u?u.getPropertyValue("direction"):r.currentStyle&&r.currentStyle.direction)||i.parents("[dir]:first").attr("dir")||"",t.extend(this,{order:0,settings:n,$input:i,tabIndex:i.attr("tabindex")||"",tagType:"select"===r.tagName.toLowerCase()?1:2,rtl:/rtl/i.test(u),eventNS:".selectize"+ ++m.count,highlightedValue:null,isBlurring:!1,isOpen:!1,isDisabled:!1,isRequired:i.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",lastValidValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===n.loadThrottle?this.onSearchChange:(a=this.onSearchChange,l=n.loadThrottle,function(){var t=this,e=arguments;window.clearTimeout(h),h=window.setTimeout(function(){a.apply(t,e)},l)})}),this.sifter=new e(this.options,{diacritics:n.diacritics}),this.settings.options){for(s=0,o=this.settings.options.length;s<o;s++)this.registerOption(this.settings.options[s]);delete this.settings.options}if(this.settings.optgroups){for(s=0,o=this.settings.optgroups.length;s<o;s++)this.registerOptionGroup(this.settings.optgroups[s]);delete this.settings.optgroups}this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi"),"boolean"!=typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode),this.initializePlugins(this.settings.plugins),this.setupCallbacks(),this.setupTemplates(),this.setup()};return n.mixin(m),void 0!==i?i.mixin(m):(u="Dependency MicroPlugin is missing",p=(p={explanation:'Make sure you either: (1) are using the "standalone" version of Selectize, or (2) require MicroPlugin before you load Selectize.'})||{},console.error("Selectize: "+u),p.explanation&&(console.group&&console.group(),console.error(p.explanation),console.group&&console.groupEnd())),t.extend(m.prototype,{setup:function(){var e,i,n,s=this,o=s.settings,r=s.eventNS,a=t(window),l=t(document),u=s.$input,p=s.settings.mode,v=u.attr("class")||"",m=t("<div>").addClass(o.wrapperClass).addClass(v).addClass(p),y=t("<div>").addClass(o.inputClass).addClass("items").appendTo(m),w=t('<input type="text" autocomplete="new-password" autofill="no" />').appendTo(y).attr("tabindex",u.is(":disabled")?"-1":s.tabIndex),O=t(o.dropdownParent||m),$=t("<div>").addClass(o.dropdownClass).addClass(p).hide().appendTo(O);p=t("<div>").addClass(o.dropdownContentClass).attr("tabindex","-1").appendTo($);(O=u.attr("id"))&&(w.attr("id",O+"-selectized"),t("label[for='"+O+"']").attr("for",O+"-selectized")),s.settings.copyClassesToDropdown&&$.addClass(v),m.css({width:u[0].style.width}),s.plugins.names.length&&(e="plugin-"+s.plugins.names.join(" plugin-"),m.addClass(e),$.addClass(e)),(null===o.maxItems||1<o.maxItems)&&1===s.tagType&&u.attr("multiple","multiple"),s.settings.placeholder&&w.attr("placeholder",o.placeholder),!s.settings.splitOn&&s.settings.delimiter&&(e=s.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),s.settings.splitOn=new RegExp("\\s*"+e+"+\\s*")),u.attr("autocorrect")&&w.attr("autocorrect",u.attr("autocorrect")),u.attr("autocapitalize")&&w.attr("autocapitalize",u.attr("autocapitalize")),w[0].type=u[0].type,s.$wrapper=m,s.$control=y,s.$control_input=w,s.$dropdown=$,s.$dropdown_content=p,$.on("mouseenter mousedown click","[data-disabled]>[data-selectable]",function(t){t.stopImmediatePropagation()}),$.on("mouseenter","[data-selectable]",function(){return s.onOptionHover.apply(s,arguments)}),$.on("mousedown click","[data-selectable]",function(){return s.onOptionSelect.apply(s,arguments)}),p="mousedown",$="*:not(input)",n=function(){return s.onItemSelect.apply(s,arguments)},(i=y).on(p,$,function(t){for(var e=t.target;e&&e.parentNode!==i[0];)e=e.parentNode;return t.currentTarget=e,n.apply(this,[t])}),h(w),y.on({mousedown:function(){return s.onMouseDown.apply(s,arguments)},click:function(){return s.onClick.apply(s,arguments)}}),w.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return s.onKeyDown.apply(s,arguments)},keyup:function(){return s.onKeyUp.apply(s,arguments)},keypress:function(){return s.onKeyPress.apply(s,arguments)},resize:function(){s.positionDropdown.apply(s,[])},blur:function(){return s.onBlur.apply(s,arguments)},focus:function(){return s.ignoreBlur=!1,s.onFocus.apply(s,arguments)},paste:function(){return s.onPaste.apply(s,arguments)}}),l.on("keydown"+r,function(t){s.isCmdDown=t[c?"metaKey":"ctrlKey"],s.isCtrlDown=t[c?"altKey":"ctrlKey"],s.isShiftDown=t.shiftKey}),l.on("keyup"+r,function(t){t.keyCode===g&&(s.isCtrlDown=!1),16===t.keyCode&&(s.isShiftDown=!1),t.keyCode===d&&(s.isCmdDown=!1)}),l.on("mousedown"+r,function(t){if(s.isFocused){if(t.target===s.$dropdown[0]||t.target.parentNode===s.$dropdown[0])return!1;s.$control.has(t.target).length||t.target===s.$control[0]||s.blur(t.target)}}),a.on(["scroll"+r,"resize"+r].join(" "),function(){s.isOpen&&s.positionDropdown.apply(s,arguments)}),a.on("mousemove"+r,function(){s.ignoreHover=!1}),this.revertSettings={$children:u.children().detach(),tabindex:u.attr("tabindex")},u.attr("tabindex",-1).hide().after(s.$wrapper),t.isArray(o.items)&&(s.lastValidValue=o.items,s.setValue(o.items),delete o.items),f&&u.on("invalid"+r,function(t){t.preventDefault(),s.isInvalid=!0,s.refreshState()}),s.updateOriginalInput(),s.refreshItems(),s.refreshState(),s.updatePlaceholder(),s.isSetup=!0,u.is(":disabled")&&s.disable(),s.on("change",this.onChange),u.data("selectize",s),u.addClass("selectized"),s.trigger("initialize"),!0===o.preload&&s.onSearchChange("")},setupTemplates:function(){var e=this.settings.labelField,i=this.settings.optgroupLabelField,n={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[i])+"</div>"},option:function(t,i){return'<div class="option">'+i(t[e])+"</div>"},item:function(t,i){return'<div class="item">'+i(t[e])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};this.settings.render=t.extend({},n,this.settings.render)},setupCallbacks:function(){var t,e,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur",dropdown_item_activate:"onDropdownItemActivate",dropdown_item_deactivate:"onDropdownItemDeactivate"};for(t in i)i.hasOwnProperty(t)&&(e=this.settings[i[t]])&&this.on(t,e)},onClick:function(t){this.isFocused&&this.isOpen||(this.focus(),t.preventDefault())},onMouseDown:function(e){var i=this,n=e.isDefaultPrevented();if(t(e.target),i.isFocused){if(e.target!==i.$control_input[0])return"single"===i.settings.mode?i.isOpen?i.close():i.open():n||i.setActiveItem(null),!1}else n||window.setTimeout(function(){i.focus()},0)},onChange:function(){""!==this.getValue()&&(this.lastValidValue=this.getValue()),this.$input.trigger("input"),this.$input.trigger("change")},onPaste:function(e){var i=this;i.isFull()||i.isInputHidden||i.isLocked?e.preventDefault():i.settings.splitOn&&setTimeout(function(){var e=i.$control_input.val();if(e.match(i.settings.splitOn))for(var n=t.trim(e).split(i.settings.splitOn),s=0,o=n.length;s<o;s++)i.createItem(n[s])},0)},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&"multi"===this.settings.mode&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){var e;if(t.target,this.$control_input[0],this.isLocked)9!==t.keyCode&&t.preventDefault();else{switch(t.keyCode){case 65:if(this.isCmdDown)return void this.selectAll();break;case 27:return void(this.isOpen&&(t.preventDefault(),t.stopPropagation(),this.close()));case 78:if(!t.ctrlKey||t.altKey)break;case 40:return!this.isOpen&&this.hasOptions?this.open():this.$activeOption&&(this.ignoreHover=!0,(e=this.getAdjacentOption(this.$activeOption,1)).length&&this.setActiveOption(e,!0,!0)),void t.preventDefault();case 80:if(!t.ctrlKey||t.altKey)break;case 38:return this.$activeOption&&(this.ignoreHover=!0,(e=this.getAdjacentOption(this.$activeOption,-1)).length&&this.setActiveOption(e,!0,!0)),void t.preventDefault();case 13:return void(this.isOpen&&this.$activeOption&&(this.onOptionSelect({currentTarget:this.$activeOption}),t.preventDefault()));case 37:return void this.advanceSelection(-1,t);case 39:return void this.advanceSelection(1,t);case 9:return this.settings.selectOnTab&&this.isOpen&&this.$activeOption&&(this.onOptionSelect({currentTarget:this.$activeOption}),this.isFull()||t.preventDefault()),void(this.settings.create&&this.createItem()&&t.preventDefault());case 8:this.isOpen&&this.close();case 46:return void this.deleteSelection(t)}!this.isFull()&&!this.isInputHidden||(c?t.metaKey:t.ctrlKey)||t.preventDefault()}},onKeyUp:function(t){if(this.isLocked)return t&&t.preventDefault();t=this.$control_input.val()||"",this.lastValue!==t&&(this.lastValue=t,this.onSearchChange(t),this.refreshOptions(),this.trigger("type",t))},onSearchChange:function(t){var e=this,i=e.settings.load;i&&(e.loadedSearches.hasOwnProperty(t)||(e.loadedSearches[t]=!0,e.load(function(n){i.apply(e,[t,n])})))},onFocus:function(t){var e=this.isFocused;if(this.isDisabled)return this.blur(),t&&t.preventDefault(),!1;this.ignoreFocus||(this.isFocused=!0,"focus"===this.settings.preload&&this.onSearchChange(""),e||this.trigger("focus"),this.$activeItems.length||(this.showInput(),this.setActiveItem(null),this.refreshOptions(!!this.settings.openOnFocus)),this.refreshState())},onBlur:function(t,e){var i=this;if(i.isFocused&&(i.isFocused=!1,!i.ignoreFocus)){if(!i.ignoreBlur&&document.activeElement===i.$dropdown_content[0])return i.ignoreBlur=!0,void i.onFocus(t);t=function(){i.close(),i.setTextboxValue(""),i.setActiveItem(null),i.setActiveOption(null),i.setCaret(i.items.length),i.refreshState(),e&&e.focus&&e.focus(),i.isBlurring=!1,i.ignoreFocus=!1,i.trigger("blur")},i.isBlurring=!0,i.ignoreFocus=!0,i.settings.create&&i.settings.createOnBlur?i.createItem(null,!1,t):t()}},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(e){var i,n=this;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),(i=t(e.currentTarget)).hasClass("create")?n.createItem(null,function(){n.settings.closeAfterSelect&&n.close()}):void 0!==(i=i.attr("data-value"))&&(n.lastQuery=null,n.setTextboxValue(""),n.addItem(i),n.settings.closeAfterSelect?n.close():!n.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&n.setActiveOption(n.getOption(i)))},onItemSelect:function(t){this.isLocked||"multi"===this.settings.mode&&(t.preventDefault(),this.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,i=e.$wrapper.addClass(e.settings.loadingClass);e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||i.removeClass(e.settings.loadingClass),e.trigger("load",t)}])},getTextboxValue:function(){return this.$control_input.val()},setTextboxValue:function(t){var e=this.$control_input;e.val()!==t&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t,e){a(this,e?[]:["change"],function(){this.clear(e),this.addItems(t,e)})},setMaxItems:function(t){0===t&&(t=null),this.settings.maxItems=t,this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi"),this.refreshState()},setActiveItem:function(e,i){var n,s,o,r,a,l;if("single"!==this.settings.mode){if(!(e=t(e)).length)return t(this.$activeItems).removeClass("active"),this.$activeItems=[],void(this.isFocused&&this.showInput());if("mousedown"===(s=i&&i.type.toLowerCase())&&this.isShiftDown&&this.$activeItems.length){for(l=this.$control.children(".active:last"),o=Array.prototype.indexOf.apply(this.$control[0].childNodes,[l[0]]),(r=Array.prototype.indexOf.apply(this.$control[0].childNodes,[e[0]]))<o&&(l=o,o=r,r=l),n=o;n<=r;n++)a=this.$control[0].childNodes[n],-1===this.$activeItems.indexOf(a)&&(t(a).addClass("active"),this.$activeItems.push(a));i.preventDefault()}else"mousedown"===s&&this.isCtrlDown||"keydown"===s&&this.isShiftDown?e.hasClass("active")?(s=this.$activeItems.indexOf(e[0]),this.$activeItems.splice(s,1),e.removeClass("active")):this.$activeItems.push(e.addClass("active")[0]):(t(this.$activeItems).removeClass("active"),this.$activeItems=[e.addClass("active")[0]]);this.hideInput(),this.isFocused||this.focus()}},setActiveOption:function(e,i,n){var o,r,a,l;this.$activeOption&&(this.$activeOption.removeClass("active"),this.trigger("dropdown_item_deactivate",this.$activeOption.attr("data-value"))),this.$activeOption=null,(e=t(e)).length&&(this.$activeOption=e.addClass("active"),this.isOpen&&this.trigger("dropdown_item_activate",this.$activeOption.attr("data-value")),!i&&s(i)||(o=this.$dropdown_content.height(),r=this.$activeOption.outerHeight(!0),i=this.$dropdown_content.scrollTop()||0,e=(l=a=this.$activeOption.offset().top-this.$dropdown_content.offset().top+i)-o+r,o+i<a+r?this.$dropdown_content.stop().animate({scrollTop:e},n?this.settings.scrollDuration:0):a<i&&this.$dropdown_content.stop().animate({scrollTop:l},n?this.settings.scrollDuration:0)))},selectAll:function(){"single"!==this.settings.mode&&(this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active")),this.$activeItems.length&&(this.hideInput(),this.close()),this.focus())},hideInput:function(){this.setTextboxValue(""),this.$control_input.css({opacity:0,position:"absolute",left:this.rtl?1e4:-1e4}),this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;return t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0)),t},blur:function(t){return this.$control_input[0].blur(),this.onBlur(null,t),this},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e=[{field:e}]),{fields:t.searchField,conjunction:t.searchConjunction,sort:e,nesting:t.nesting}},search:function(e){var i,n,s,r=this.settings,a=this.getSearchOptions();if(r.score&&"function"!=typeof(s=this.settings.score.apply(this,[e])))throw new Error('Selectize "score" setting must be a function that returns a function');if(e!==this.lastQuery?(this.lastQuery=e,n=this.sifter.search(e,t.extend(a,{score:s})),this.currentResults=n):n=t.extend(!0,{},this.currentResults),r.hideSelected)for(i=n.items.length-1;0<=i;i--)-1!==this.items.indexOf(o(n.items[i].id))&&n.items.splice(i,1);return n},refreshOptions:function(e){var i,n,s,r,a,l,h,u,p,c,d,g,f,v;void 0===e&&(e=!0);var m,y,w=this,O=t.trim(w.$control_input.val()),$=w.search(O),C=w.$dropdown_content,b=w.$activeOption&&o(w.$activeOption.attr("data-value")),x=$.items.length;for("number"==typeof w.settings.maxOptions&&(x=Math.min(x,w.settings.maxOptions)),r={},a=[],i=0;i<x;i++)for(l=w.options[$.items[i].id],h=w.render("option",l),u=l[w.settings.optgroupField]||"",n=0,s=(p=t.isArray(u)?u:[u])&&p.length;n<s;n++)u=p[n],w.optgroups.hasOwnProperty(u)||(u=""),r.hasOwnProperty(u)||(r[u]=document.createDocumentFragment(),a.push(u)),r[u].appendChild(h);for(this.settings.lockOptgroupOrder&&a.sort(function(t,e){return(w.optgroups[t]&&w.optgroups[t].$order||0)-(w.optgroups[e]&&w.optgroups[e].$order||0)}),c=document.createDocumentFragment(),i=0,x=a.length;i<x;i++)u=a[i],w.optgroups.hasOwnProperty(u)&&r[u].childNodes.length?((d=document.createDocumentFragment()).appendChild(w.render("optgroup_header",w.optgroups[u])),d.appendChild(r[u]),c.appendChild(w.render("optgroup",t.extend({},w.optgroups[u],{html:(m=d,y=void 0,(y=document.createElement("div")).appendChild(m.cloneNode(!0)),y.innerHTML),dom:d})))):c.appendChild(r[u]);if(C.html(c),w.settings.highlight&&(C.removeHighlight(),$.query.length&&$.tokens.length))for(i=0,x=$.tokens.length;i<x;i++)!function(t,e){if("string"!=typeof e||e.length){var i="string"==typeof e?new RegExp(e,"i"):e,n=function(t){var e=0;if(3===t.nodeType){var s,o,r=t.data.search(i);0<=r&&0<t.data.length&&(o=t.data.match(i),(s=document.createElement("span")).className="highlight",(r=t.splitText(r)).splitText(o[0].length),o=r.cloneNode(!0),s.appendChild(o),r.parentNode.replaceChild(s,r),e=1)}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName)&&("highlight"!==t.className||"SPAN"!==t.tagName))for(var a=0;a<t.childNodes.length;++a)a+=n(t.childNodes[a]);return e};t.each(function(){n(this)})}}(C,$.tokens[i].regex);if(!w.settings.hideSelected)for(w.$dropdown.find(".selected").removeClass("selected"),i=0,x=w.items.length;i<x;i++)w.getOption(w.items[i]).addClass("selected");(g=w.canCreate(O))&&(C.prepend(w.render("option_create",{input:O})),v=t(C[0].childNodes[0])),w.hasOptions=0<$.items.length||g,w.hasOptions?(0<$.items.length?((b=b&&w.getOption(b))&&b.length?f=b:"single"===w.settings.mode&&w.items.length&&(f=w.getOption(w.items[0])),f&&f.length||(f=v&&!w.settings.addPrecedence?w.getAdjacentOption(v,1):C.find("[data-selectable]:first"))):f=v,w.setActiveOption(f),e&&!w.isOpen&&w.open()):(w.setActiveOption(null),e&&w.isOpen&&w.close())},addOption:function(e){var i,n,s;if(t.isArray(e))for(i=0,n=e.length;i<n;i++)this.addOption(e[i]);else(s=this.registerOption(e))&&(this.userOptions[s]=!0,this.lastQuery=null,this.trigger("option_add",s,e))},registerOption:function(t){var e=o(t[this.settings.valueField]);return null!=e&&!this.options.hasOwnProperty(e)&&(t.$order=t.$order||++this.order,this.options[e]=t,e)},registerOptionGroup:function(t){var e=o(t[this.settings.optgroupValueField]);return!!e&&(t.$order=t.$order||++this.order,this.optgroups[e]=t,e)},addOptionGroup:function(t,e){e[this.settings.optgroupValueField]=t,(t=this.registerOptionGroup(e))&&this.trigger("optgroup_add",t,e)},removeOptionGroup:function(t){this.optgroups.hasOwnProperty(t)&&(delete this.optgroups[t],this.renderCache={},this.trigger("optgroup_remove",t))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(e,i){var n,s,r;if(e=o(e),n=o(i[this.settings.valueField]),null!==e&&this.options.hasOwnProperty(e)){if("string"!=typeof n)throw new Error("Value must be set in option data");r=this.options[e].$order,n!==e&&(delete this.options[e],-1!==(s=this.items.indexOf(e))&&this.items.splice(s,1,n)),i.$order=i.$order||r,this.options[n]=i,s=this.renderCache.item,r=this.renderCache.option,s&&(delete s[e],delete s[n]),r&&(delete r[e],delete r[n]),-1!==this.items.indexOf(n)&&(e=this.getItem(e),i=t(this.render("item",i)),e.hasClass("active")&&i.addClass("active"),e.replaceWith(i)),this.lastQuery=null,this.isOpen&&this.refreshOptions(!1)}},removeOption:function(t,e){t=o(t);var i=this.renderCache.item,n=this.renderCache.option;i&&delete i[t],n&&delete n[t],delete this.userOptions[t],delete this.options[t],this.lastQuery=null,this.trigger("option_remove",t),this.removeItem(t,e)},clearOptions:function(e){var i=this;i.loadedSearches={},i.userOptions={},i.renderCache={};var n=i.options;t.each(i.options,function(t,e){-1==i.items.indexOf(t)&&delete n[t]}),i.options=i.sifter.items=n,i.lastQuery=null,i.trigger("option_clear"),i.clear(e)},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(e,i){var n=this.$dropdown.find("[data-selectable]");return 0<=(i=n.index(e)+i)&&i<n.length?n.eq(i):t()},getElementWithValue:function(e,i){if(null!=(e=o(e)))for(var n=0,s=i.length;n<s;n++)if(i[n].getAttribute("data-value")===e)return t(i[n]);return t()},getElementWithTextContent:function(e,i,n){if(null!=(e=o(e)))for(var s=0,r=n.length;s<r;s++){var a=n[s].textContent;if(1==i&&(a=null!==a?a.toLowerCase():null,e=e.toLowerCase()),a===e)return t(n[s])}return t()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},getFirstItemMatchedByTextContent:function(t,e){return e=null!==e&&!0===e,this.getElementWithTextContent(t,e,this.$dropdown_content.find("[data-selectable]"))},addItems:function(e,i){this.buffer=document.createDocumentFragment();for(var n=this.$control[0].childNodes,s=0;s<n.length;s++)this.buffer.appendChild(n[s]);for(var o=t.isArray(e)?e:[e],r=(s=0,o.length);s<r;s++)this.isPending=s<r-1,this.addItem(o[s],i);(e=this.$control[0]).insertBefore(this.buffer,e.firstChild),this.buffer=null},addItem:function(e,i){a(this,i?[]:["change"],function(){var n,s,r,a=this.settings.mode;e=o(e),-1===this.items.indexOf(e)?this.options.hasOwnProperty(e)&&("single"===a&&this.clear(i),"multi"===a&&this.isFull()||(n=t(this.render("item",this.options[e])),r=this.isFull(),this.items.splice(this.caretPos,0,e),this.insertAtCaret(n),this.isPending&&(r||!this.isFull())||this.refreshState(),this.isSetup&&(s=this.$dropdown_content.find("[data-selectable]"),this.isPending||(r=this.getOption(e),r=this.getAdjacentOption(r,1).attr("data-value"),this.refreshOptions(this.isFocused&&"single"!==a),r&&this.setActiveOption(this.getOption(r))),!s.length||this.isFull()?this.close():this.isPending||this.positionDropdown(),this.updatePlaceholder(),this.trigger("item_add",e,n),this.isPending||this.updateOriginalInput({silent:i})))):"single"===a&&this.close()})},removeItem:function(e,i){var n,s,r=e instanceof t?e:this.getItem(e);e=o(r.attr("data-value")),-1!==(n=this.items.indexOf(e))&&(this.trigger("item_before_remove",e,r),r.remove(),r.hasClass("active")&&(s=this.$activeItems.indexOf(r[0]),this.$activeItems.splice(s,1)),this.items.splice(n,1),this.lastQuery=null,!this.settings.persist&&this.userOptions.hasOwnProperty(e)&&this.removeOption(e,i),n<this.caretPos&&this.setCaret(this.caretPos-1),this.refreshState(),this.updatePlaceholder(),this.updateOriginalInput({silent:i}),this.positionDropdown(),this.trigger("item_remove",e,r))},createItem:function(e,i){var n=this,s=n.caretPos;e=e||t.trim(n.$control_input.val()||"");var r=arguments[arguments.length-1];if("function"!=typeof r&&(r=function(){}),"boolean"!=typeof i&&(i=!0),!n.canCreate(e))return r(),!1;n.lock();var a,l,h="function"==typeof n.settings.create?this.settings.create:function(t){var e={};return e[n.settings.labelField]=t,e[n.settings.valueField]=t,e},u=(l=!(a=function(t){if(n.unlock(),!t||"object"!=typeof t)return r();var e=o(t[n.settings.valueField]);if("string"!=typeof e)return r();n.setTextboxValue(""),n.addOption(t),n.setCaret(s),n.addItem(e),n.refreshOptions(i&&"single"!==n.settings.mode),r(t)}),function(){l||(l=!0,a.apply(this,arguments))});return void 0!==(e=h.apply(this,[e,u]))&&u(e),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){this.refreshValidityState(),this.refreshClasses()},refreshValidityState:function(){if(!this.isRequired)return!1;var t=!this.items.length;this.isInvalid=t,this.$control_input.prop("required",t),this.$input.prop("required",!t)},refreshClasses:function(){var e=this.isFull(),i=this.isLocked;this.$wrapper.toggleClass("rtl",this.rtl),this.$control.toggleClass("focus",this.isFocused).toggleClass("disabled",this.isDisabled).toggleClass("required",this.isRequired).toggleClass("invalid",this.isInvalid).toggleClass("locked",i).toggleClass("full",e).toggleClass("not-full",!e).toggleClass("input-active",this.isFocused&&!this.isInputHidden).toggleClass("dropdown-active",this.isOpen).toggleClass("has-options",!t.isEmptyObject(this.options)).toggleClass("has-items",0<this.items.length),this.$control_input.data("grow",!e&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(t){var e,i,n,s;if(t=t||{},1===this.tagType){for(n=[],e=0,i=this.items.length;e<i;e++)s=this.options[this.items[e]][this.settings.labelField]||"",n.push('<option value="'+r(this.items[e])+'" selected="selected">'+r(s)+"</option>");n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),this.$input.html(n.join(""))}else this.$input.val(this.getValue()),this.$input.attr("value",this.$input.val());this.isSetup&&(t.silent||this.trigger("change",this.$input.val()))},updatePlaceholder:function(){var t;this.settings.placeholder&&(t=this.$control_input,this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0}))},open:function(){this.$control_input.val().length<4||this.isLocked||this.isOpen||"multi"===this.settings.mode&&this.isFull()||(this.focus(),this.isOpen=!0,this.refreshState(),this.$dropdown.css({visibility:"hidden",display:"block"}),this.positionDropdown(),this.$dropdown.css({visibility:"visible"}),this.trigger("dropdown_open",this.$dropdown))},close:function(){var t=this.isOpen;"single"===this.settings.mode&&this.items.length&&(this.hideInput(),this.isBlurring&&this.$control_input.blur()),this.isOpen=!1,this.$dropdown.hide(),this.setActiveOption(null),this.refreshState(),t&&this.trigger("dropdown_close",this.$dropdown)},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t[0].getBoundingClientRect().width,top:e.top,left:e.left})},clear:function(t){this.items.length&&(this.$control.children(":not(input)").remove(),this.items=[],this.lastQuery=null,this.setCaret(0),this.setActiveItem(null),this.updatePlaceholder(),this.updateOriginalInput({silent:t}),this.refreshState(),this.showInput(),this.trigger("clear"))},insertAtCaret:function(t){var e=Math.min(this.caretPos,this.items.length),i=t[0];t=this.buffer||this.$control[0];0===e?t.insertBefore(i,t.firstChild):t.insertBefore(i,t.childNodes[e]),this.setCaret(e+1)},deleteSelection:function(e){var i,n,s,o,r,a,h=e&&8===e.keyCode?-1:1,u=l(this.$control_input[0]);if(this.$activeOption&&!this.settings.hideSelected&&(o=this.getAdjacentOption(this.$activeOption,-1).attr("data-value")),s=[],this.$activeItems.length){for(a=this.$control.children(".active:"+(0<h?"last":"first")),a=this.$control.children(":not(input)").index(a),0<h&&a++,i=0,n=this.$activeItems.length;i<n;i++)s.push(t(this.$activeItems[i]).attr("data-value"));e&&(e.preventDefault(),e.stopPropagation())}else(this.isFocused||"single"===this.settings.mode)&&this.items.length&&(h<0&&0===u.start&&0===u.length?s.push(this.items[this.caretPos-1]):0<h&&u.start===this.$control_input.val().length&&s.push(this.items[this.caretPos]));if(!s.length||"function"==typeof this.settings.onDelete&&!1===this.settings.onDelete.apply(this,[s]))return!1;for(void 0!==a&&this.setCaret(a);s.length;)this.removeItem(s.pop());return this.showInput(),this.positionDropdown(),this.refreshOptions(!0),o&&(r=this.getOption(o)).length&&this.setActiveOption(r),!0},advanceSelection:function(t,e){var i,n,s;0!==t&&(this.rtl&&(t*=-1),s=0<t?"last":"first",i=l(this.$control_input[0]),this.isFocused&&!this.isInputHidden?(n=this.$control_input.val().length,(t<0?0!==i.start||0!==i.length:i.start!==n)||n||this.advanceCaret(t,e)):(s=this.$control.children(".active:"+s)).length&&(s=this.$control.children(":not(input)").index(s),this.setActiveItem(null),this.setCaret(0<t?s+1:s)))},advanceCaret:function(t,e){var i;0!==t&&(i=0<t?"next":"prev",this.isShiftDown?(i=this.$control_input[i]()).length&&(this.hideInput(),this.setActiveItem(i),e&&e.preventDefault()):this.setCaret(this.caretPos+t))},setCaret:function(e){if(e="single"===this.settings.mode?this.items.length:Math.max(0,Math.min(this.items.length,e)),!this.isPending)for(var i,n=this.$control.children(":not(input)"),s=0,o=n.length;s<o;s++)i=t(n[s]).detach(),s<e?this.$control_input.before(i):this.$control.append(i);this.caretPos=e},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){this.$input.prop("disabled",!0),this.$control_input.prop("disabled",!0).prop("tabindex",-1),this.isDisabled=!0,this.lock()},enable:function(){this.$input.prop("disabled",!1),this.$control_input.prop("disabled",!1).prop("tabindex",this.tabIndex),this.isDisabled=!1,this.unlock()},destroy:function(){var e=this.eventNS,i=this.revertSettings;this.trigger("destroy"),this.off(),this.$wrapper.remove(),this.$dropdown.remove(),this.$input.html("").append(i.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:i.tabindex}).show(),this.$control_input.removeData("grow"),this.$input.removeData("selectize"),0==--m.count&&m.$testInput&&(m.$testInput.remove(),m.$testInput=void 0),t(window).off(e),t(document).off(e),t(document.body).off(e),delete this.$input[0].selectize},render:function(e,i){var n,a,l="",h=!1;return(h="option"===e||"item"===e?!!(n=o(i[this.settings.valueField])):h)&&(s(this.renderCache[e])||(this.renderCache[e]={}),this.renderCache[e].hasOwnProperty(n))?this.renderCache[e][n]:(l=t(this.settings.render[e].apply(this,[i,r])),"option"===e||"option_create"===e?i[this.settings.disabledField]||l.attr("data-selectable",""):"optgroup"===e&&(a=i[this.settings.optgroupValueField]||"",l.attr("data-group",a),i[this.settings.disabledField]&&l.attr("data-disabled","")),"option"!==e&&"item"!==e||l.attr("data-value",n||""),h&&(this.renderCache[e][n]=l[0]),l[0])},clearCache:function(t){void 0===t?this.renderCache={}:delete this.renderCache[t]},canCreate:function(t){if(!this.settings.create)return!1;var e=this.settings.createFilter;return t.length&&("function"!=typeof e||e.apply(this,[t]))&&("string"!=typeof e||new RegExp(e).test(t))&&(!(e instanceof RegExp)||e.test(t))}}),m.count=0,m.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!0,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},t.fn.selectize=function(e){var i=t.fn.selectize.defaults,n=t.extend({},i,e),s=n.dataAttr,r=n.labelField,a=n.valueField,l=n.disabledField,h=n.optgroupField,u=n.optgroupLabelField,p=n.optgroupValueField;return this.each(function(){var c,d,g;this.selectize||(c=t(this),d=this.tagName.toLowerCase(),g={placeholder:g=(g=c.attr("placeholder")||c.attr("data-placeholder"))||n.allowEmptyOption?g:c.children('option[value=""]').text(),options:[],optgroups:[],items:[]},("select"===d?function(e,i){function c(t){return"string"==typeof(t=s&&t.attr(s))&&t.length?JSON.parse(t):null}function d(e,s){var u,p=o((e=t(e)).val());(p||n.allowEmptyOption)&&(w.hasOwnProperty(p)?s&&((u=w[p][h])?t.isArray(u)?u.push(s):w[p][h]=[u,s]:w[p][h]=s):((u=c(e)||{})[r]=u[r]||e.text(),u[a]=u[a]||p,u[l]=u[l]||e.prop("disabled"),u[h]=u[h]||s,w[p]=u,y.push(u),e.is(":selected")&&i.items.push(p)))}var g,f,v,m,y=i.options,w={};for(i.maxItems=e.attr("multiple")?null:1,g=0,f=(m=e.children()).length;g<f;g++)"optgroup"===(v=m[g].tagName.toLowerCase())?function(e){var n,s,o,r,a;for((o=(e=t(e)).attr("label"))&&((r=c(e)||{})[u]=o,r[p]=o,r[l]=e.prop("disabled"),i.optgroups.push(r)),n=0,s=(a=t("option",e)).length;n<s;n++)d(a[n],o)}(m[g]):"option"===v&&d(m[g])}:function(e,i){var o,l,h,u,p=e.attr(s);if(p)for(i.options=JSON.parse(p),o=0,l=i.options.length;o<l;o++)i.items.push(i.options[o][a]);else if(e=t.trim(e.val()||""),n.allowEmptyOption||e.length){for(o=0,l=(h=e.split(n.delimiter)).length;o<l;o++)(u={})[r]=h[o],u[a]=h[o],i.options.push(u);i.items=h}})(c,g),new m(c,t.extend(!0,{},i,g,e)))})},t.fn.selectize.defaults=m.defaults,t.fn.selectize.support={validity:f},m.define("auto_select_on_type",function(t){var e,i=this;i.onBlur=(e=i.onBlur,function(t){var n=i.getFirstItemMatchedByTextContent(i.lastValue,!0);return void 0!==n.attr("data-value")&&i.getValue()!==n.attr("data-value")&&i.setValue(n.attr("data-value")),e.apply(this,arguments)})}),m.define("autofill_disable",function(t){var e,i=this;i.setup=(e=i.setup,function(){e.apply(i,arguments),i.$control_input.attr({autocomplete:"new-password",autofill:"no"})})}),m.define("drag_drop",function(e){if(!t.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');var i,n;"multi"===this.settings.mode&&((i=this).lock=(n=i.lock,function(){var t=i.$control.data("sortable");return t&&t.disable(),n.apply(i,arguments)}),i.unlock=function(){var t=i.unlock;return function(){var e=i.$control.data("sortable");return e&&e.enable(),t.apply(i,arguments)}}(),i.setup=function(){var e=i.setup;return function(){e.apply(this,arguments);var n=i.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:i.isLocked,start:function(t,e){e.placeholder.css("width",e.helper.css("width")),n.css({overflow:"visible"})},stop:function(){n.css({overflow:"hidden"});var e=i.$activeItems?i.$activeItems.slice():null,s=[];n.children("[data-value]").each(function(){s.push(t(this).attr("data-value"))}),i.setValue(s),i.setActiveItem(e)}})}}())}),m.define("dropdown_header",function(e){var i,n=this;e=t.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},e),n.setup=(i=n.setup,function(){i.apply(n,arguments),n.$dropdown_header=t(e.html(e)),n.$dropdown.prepend(n.$dropdown_header)})}),m.define("optgroup_columns",function(e){var i,n=this;function s(){var i,s,r,a,l=t("[data-group]",n.$dropdown_content),h=l.length;if(h&&n.$dropdown_content.width()){if(e.equalizeHeight){for(i=s=0;i<h;i++)s=Math.max(s,l.eq(i).height());l.css({height:s})}e.equalizeWidth&&(a=n.$dropdown_content.innerWidth()-o(),r=Math.round(a/h),l.css({width:r}),1<h&&(r=a-r*(h-1),l.eq(h-1).css({width:r})))}}e=t.extend({equalizeWidth:!0,equalizeHeight:!0},e),this.getAdjacentOption=function(e,i){var n=e.closest("[data-group]").find("[data-selectable]");return 0<=(i=n.index(e)+i)&&i<n.length?n.eq(i):t()},this.onKeyDown=(i=n.onKeyDown,function(t){var e,s;return!this.isOpen||37!==t.keyCode&&39!==t.keyCode?i.apply(this,arguments):(n.ignoreHover=!0,e=(s=this.$activeOption.closest("[data-group]")).find("[data-selectable]").index(this.$activeOption),void((e=(s=(s=37===t.keyCode?s.prev("[data-group]"):s.next("[data-group]")).find("[data-selectable]")).eq(Math.min(s.length-1,e))).length&&this.setActiveOption(e)))});var o=function(){var t,e=o.width,i=document;return void 0===e&&((t=i.createElement("div")).innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',t=t.firstChild,i.body.appendChild(t),e=o.width=t.offsetWidth-t.clientWidth,i.body.removeChild(t)),e};(e.equalizeHeight||e.equalizeWidth)&&(v(this,"positionDropdown",s),v(this,"refreshOptions",s))}),m.define("remove_button",function(e){e=t.extend({label:"&times;",title:"Remove",className:"remove",append:!0},e),("single"===this.settings.mode?function(e,i){i.className="remove-single";var n,s=e,o='<a href="javascript:void(0)" class="'+i.className+'" tabindex="-1" title="'+r(i.title)+'">'+i.label+"</a>";e.setup=(n=s.setup,function(){var r,a;i.append&&(r=t(s.$input.context).attr("id"),t("#"+r),a=s.settings.render.item,s.settings.render.item=function(i){return n=a.apply(e,arguments),s=o,t("<span>").append(n).append(s);var n,s}),n.apply(e,arguments),e.$control.on("click","."+i.className,function(t){t.preventDefault(),s.isLocked||s.clear()})})}:function(e,i){var n,s=e,o='<a href="javascript:void(0)" class="'+i.className+'" tabindex="-1" title="'+r(i.title)+'">'+i.label+"</a>";e.setup=(n=s.setup,function(){var r;i.append&&(r=s.settings.render.item,s.settings.render.item=function(t){return i=r.apply(e,arguments),n=o,s=i.search(/(<\/[^>]+>\s*)$/),i.substring(0,s)+n+i.substring(s);var i,n,s}),n.apply(e,arguments),e.$control.on("click","."+i.className,function(e){if(e.preventDefault(),!s.isLocked)return e=t(e.currentTarget).parent(),s.setActiveItem(e),s.deleteSelection()&&s.setCaret(s.items.length),!1})})})(this,e)}),m.define("restore_on_backspace",function(t){var e;t.text=t.text||function(t){return t[this.settings.labelField]},this.onKeyDown=(e=this.onKeyDown,function(i){var n;return 8===i.keyCode&&""===this.$control_input.val()&&!this.$activeItems.length&&0<=(n=this.caretPos-1)&&n<this.items.length?(n=this.options[this.items[n]],this.deleteSelection(i)&&(this.setTextboxValue(t.text.apply(this,[n])),this.refreshOptions(!0)),void i.preventDefault()):e.apply(this,arguments)})}),m.define("select_on_focus",function(t){var e,i,n=this;n.on("focus",(e=n.onFocus,function(t){var i=n.getItem(n.getValue()).text();return n.clear(),n.setTextboxValue(i),n.$control_input.select(),setTimeout(function(){n.settings.selectOnTab&&n.setActiveOption(n.getFirstItemMatchedByTextContent(i)),n.settings.score=null},0),e.apply(this,arguments)})),n.onBlur=(i=n.onBlur,function(t){return""===n.getValue()&&n.lastValidValue!==n.getValue()&&n.setValue(n.lastValidValue),setTimeout(function(){n.settings.score=function(){return function(){return 1}}},0),i.apply(this,arguments)}),n.settings.score=function(){return function(){return 1}}}),m});